"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdateredmine_epic_grid"]("main",{

/***/ "./assets/javascripts/epic_grid/src/mocks/handlers.ts":
/*!************************************************************!*\
  !*** ./assets/javascripts/epic_grid/src/mocks/handlers.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentMockData: () => (/* binding */ getCurrentMockData),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   setMockData: () => (/* binding */ setMockData)\n/* harmony export */ });\n/* harmony import */ var msw__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! msw */ \"./assets/javascripts/epic_grid/node_modules/msw/lib/core/http.mjs\");\n/* harmony import */ var msw__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! msw */ \"./assets/javascripts/epic_grid/node_modules/msw/lib/core/HttpResponse.mjs\");\n/* harmony import */ var msw__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! msw */ \"./assets/javascripts/epic_grid/node_modules/msw/lib/core/delay.mjs\");\n/* harmony import */ var _normalized_mock_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./normalized-mock-data */ \"./assets/javascripts/epic_grid/src/mocks/normalized-mock-data.ts\");\n/* harmony import */ var _utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/naturalSort */ \"./assets/javascripts/epic_grid/src/utils/naturalSort.ts\");\n\n\n\n// モックデータのディープコピー (状態を保持するため)\nlet currentData = JSON.parse(JSON.stringify(_normalized_mock_data__WEBPACK_IMPORTED_MODULE_3__.normalizedMockData));\n// 最終更新タイムスタンプ (差分更新用)\nlet lastUpdateTimestamp = new Date().toISOString();\n// ========================================\n// フィルタヘルパー関数\n// ========================================\n/**\n * Ransackフィルタを適用してエンティティをフィルタリング\n * 基本的なフィルタのみ対応（_in, _eq, _null）\n */\n/**\n * URLクエリパラメータからソートオプションを抽出\n */\nfunction extractSortOptionsFromURL(url) {\n    return {\n        epic_sort_by: url.searchParams.get('sort_options[epic][sort_by]') || undefined,\n        epic_sort_direction: url.searchParams.get('sort_options[epic][sort_direction]') || undefined,\n        version_sort_by: url.searchParams.get('sort_options[version][sort_by]') || undefined,\n        version_sort_direction: url.searchParams.get('sort_options[version][sort_direction]') || undefined\n    };\n}\nfunction applyRansackFilters(entities, filters) {\n    if (!filters || Object.keys(filters).length === 0) {\n        return entities;\n    }\n    const filtered = {};\n    Object.entries(entities).forEach(([id, entity]) => {\n        let matches = true;\n        // バージョンフィルタ (fixed_version_id_in)\n        if (filters.fixed_version_id_in && filters.fixed_version_id_in.length > 0) {\n            const versionId = entity.fixed_version_id;\n            if (!versionId || !filters.fixed_version_id_in.includes(versionId)) {\n                matches = false;\n            }\n        }\n        // バージョンフィルタ (fixed_version_id_eq)\n        if (filters.fixed_version_id_eq !== undefined) {\n            if (entity.fixed_version_id !== filters.fixed_version_id_eq) {\n                matches = false;\n            }\n        }\n        // バージョンNULLフィルタ\n        if (filters.fixed_version_id_null !== undefined) {\n            const isNull = entity.fixed_version_id === null || entity.fixed_version_id === undefined;\n            if (filters.fixed_version_id_null !== isNull) {\n                matches = false;\n            }\n        }\n        // ステータスフィルタ (status_id_in) - statusを文字列から推測\n        // MSWモックでは status: 'open' | 'closed' なので、簡易マッピング\n        if (filters.status_id_in && filters.status_id_in.length > 0) {\n            // 簡易実装: status文字列をIDに変換（実際のRedmineではID使用）\n            // open=1, in_progress=2, closed=5 と仮定\n            const statusIdMap = { open: 1, in_progress: 2, closed: 5 };\n            const statusId = entity.status ? statusIdMap[entity.status] : undefined;\n            if (!statusId || !filters.status_id_in.includes(statusId)) {\n                matches = false;\n            }\n        }\n        // 担当者フィルタ (assigned_to_id_in)\n        if (filters.assigned_to_id_in && filters.assigned_to_id_in.length > 0) {\n            if (!entity.assigned_to_id || !filters.assigned_to_id_in.includes(entity.assigned_to_id)) {\n                matches = false;\n            }\n        }\n        // 担当者NULLフィルタ\n        if (filters.assigned_to_id_null !== undefined) {\n            const isNull = entity.assigned_to_id === null || entity.assigned_to_id === undefined;\n            if (filters.assigned_to_id_null !== isNull) {\n                matches = false;\n            }\n        }\n        // トラッカーフィルタ (tracker_id_in)\n        if (filters.tracker_id_in && filters.tracker_id_in.length > 0) {\n            if (!entity.tracker_id || !filters.tracker_id_in.includes(entity.tracker_id)) {\n                matches = false;\n            }\n        }\n        // 親IDフィルタ (parent_id_in) - Epic/Feature/UserStoryの親子関係\n        if (filters.parent_id_in && filters.parent_id_in.length > 0) {\n            const parentId = entity.parent_epic_id || entity.parent_feature_id || entity.parent_user_story_id;\n            if (!parentId || !filters.parent_id_in.includes(parentId)) {\n                matches = false;\n            }\n        }\n        if (matches) {\n            filtered[id] = entity;\n        }\n    });\n    return filtered;\n}\n/**\n * URLクエリパラメータからRansackフィルタを抽出\n */\nfunction extractFiltersFromURL(url) {\n    const filters = {};\n    // fixed_version_id_in (カンマ区切り)\n    const versionIds = url.searchParams.get('fixed_version_id_in');\n    if (versionIds) {\n        filters.fixed_version_id_in = versionIds.split(',');\n    }\n    // status_id_in (カンマ区切り)\n    const statusIds = url.searchParams.get('status_id_in');\n    if (statusIds) {\n        filters.status_id_in = statusIds.split(',').map(Number);\n    }\n    // assigned_to_id_in (カンマ区切り)\n    const assigneeIds = url.searchParams.get('assigned_to_id_in');\n    if (assigneeIds) {\n        filters.assigned_to_id_in = assigneeIds.split(',').map(Number);\n    }\n    // tracker_id_in (カンマ区切り)\n    const trackerIds = url.searchParams.get('tracker_id_in');\n    if (trackerIds) {\n        filters.tracker_id_in = trackerIds.split(',').map(Number);\n    }\n    // parent_id_in (カンマ区切り) - Epic/Featureフィルタ用\n    const parentIds = url.searchParams.get('parent_id_in');\n    if (parentIds) {\n        filters.parent_id_in = parentIds.split(',');\n    }\n    // _null フィルタ\n    const versionNull = url.searchParams.get('fixed_version_id_null');\n    if (versionNull !== null) {\n        filters.fixed_version_id_null = versionNull === 'true';\n    }\n    const assigneeNull = url.searchParams.get('assigned_to_id_null');\n    if (assigneeNull !== null) {\n        filters.assigned_to_id_null = assigneeNull === 'true';\n    }\n    return filters;\n}\n// ========================================\n// API Handlers\n// ========================================\nconst handlers = [\n    // GET /api/epic_grid/projects/:projectId/grid\n    // グリッドデータ取得\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.get('/api/epic_grid/projects/:projectId/grid', async ({ params, request }) => {\n        const url = new URL(request.url);\n        const includeClosed = url.searchParams.get('include_closed') === 'true';\n        const excludeClosedVersions = url.searchParams.get('exclude_closed_versions') === 'true';\n        // Ransackフィルタを抽出\n        const filters = extractFiltersFromURL(url);\n        // ソートオプションを抽出\n        const sortOptions = extractSortOptionsFromURL(url);\n        // リアルなAPI遅延をシミュレート (開発時は削除可能)\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(300);\n        // データをディープコピー\n        let responseData = JSON.parse(JSON.stringify(currentData));\n        // Ransackフィルタを適用\n        if (Object.keys(filters).length > 0) {\n            responseData.entities.epics = applyRansackFilters(responseData.entities.epics, filters);\n            responseData.entities.features = applyRansackFilters(responseData.entities.features, filters);\n            responseData.entities.user_stories = applyRansackFilters(responseData.entities.user_stories, filters);\n            responseData.entities.tasks = applyRansackFilters(responseData.entities.tasks, filters);\n            responseData.entities.tests = applyRansackFilters(responseData.entities.tests, filters);\n            responseData.entities.bugs = applyRansackFilters(responseData.entities.bugs, filters);\n        }\n        // exclude_closed_versions=true の場合、クローズ済みバージョンを除外\n        if (excludeClosedVersions) {\n            // Versionからclosedを除外\n            Object.keys(responseData.entities.versions).forEach(id => {\n                if (responseData.entities.versions[id].status === 'closed') {\n                    delete responseData.entities.versions[id];\n                }\n            });\n            // version_order からも削除\n            responseData.grid.version_order = responseData.grid.version_order.filter((vId) => responseData.entities.versions[vId]);\n            // grid.index からクローズ済みバージョンのセルを削除\n            Object.keys(responseData.grid.index).forEach(cellKey => {\n                // cellKey = \"epicId:featureId:versionId\"\n                const versionId = cellKey.split(':')[2];\n                if (versionId !== 'none' && !responseData.entities.versions[versionId]) {\n                    delete responseData.grid.index[cellKey];\n                }\n            });\n        }\n        // include_closed=false の場合、closedステータスをフィルタ (既存ロジック維持)\n        if (!includeClosed) {\n            // Featureからclosedを除外\n            Object.keys(responseData.entities.features).forEach(id => {\n                if (responseData.entities.features[id].status === 'closed') {\n                    delete responseData.entities.features[id];\n                }\n            });\n            // UserStoryからclosedを除外\n            Object.keys(responseData.entities.user_stories).forEach(id => {\n                if (responseData.entities.user_stories[id].status === 'closed') {\n                    delete responseData.entities.user_stories[id];\n                }\n            });\n            // grid.indexも更新 (closedのUserStoryを削除)\n            Object.keys(responseData.grid.index).forEach(key => {\n                responseData.grid.index[key] = responseData.grid.index[key].filter((userStoryId) => responseData.entities.user_stories[userStoryId]);\n            });\n            // feature_order_by_epicからclosedのFeatureを削除\n            Object.keys(responseData.grid.feature_order_by_epic).forEach(epicId => {\n                responseData.grid.feature_order_by_epic[epicId] = responseData.grid.feature_order_by_epic[epicId].filter((featureId) => responseData.entities.features[featureId]);\n            });\n        }\n        // Ransackフィルタ適用後のgrid更新\n        if (Object.keys(filters).length > 0) {\n            // epic_order: フィルタ後に存在するEpicのみ\n            responseData.grid.epic_order = responseData.grid.epic_order.filter((epicId) => responseData.entities.epics[epicId]);\n            // feature_order_by_epic: フィルタ後に存在するFeatureのみ\n            Object.keys(responseData.grid.feature_order_by_epic).forEach(epicId => {\n                responseData.grid.feature_order_by_epic[epicId] = responseData.grid.feature_order_by_epic[epicId].filter((featureId) => responseData.entities.features[featureId]);\n            });\n            // grid.index: フィルタ後に存在するUserStoryのみ\n            Object.keys(responseData.grid.index).forEach(key => {\n                responseData.grid.index[key] = responseData.grid.index[key].filter((userStoryId) => responseData.entities.user_stories[userStoryId]);\n            });\n        }\n        // ========================================\n        // ソート処理（自然順ソート）\n        // ========================================\n        if (sortOptions.epic_sort_by === 'subject') {\n            // Epic順序を自然順ソート\n            const epicOrder = responseData.grid.epic_order.filter((epicId) => responseData.entities.epics[epicId]);\n            const sortedEpics = epicOrder.sort((aId, bId) => {\n                const epicA = responseData.entities.epics[aId];\n                const epicB = responseData.entities.epics[bId];\n                if (!epicA || !epicB)\n                    return 0;\n                const keyA = (0,_utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__.naturalSortKey)(epicA.subject);\n                const keyB = (0,_utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__.naturalSortKey)(epicB.subject);\n                return (0,_utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__.compareNaturalSort)(keyA, keyB);\n            });\n            // 降順の場合は逆順\n            if (sortOptions.epic_sort_direction === 'desc') {\n                sortedEpics.reverse();\n            }\n            responseData.grid.epic_order = sortedEpics;\n            // Feature順序も同様に自然順ソート（Epic内のFeature）\n            Object.keys(responseData.grid.feature_order_by_epic).forEach(epicId => {\n                const featureIds = responseData.grid.feature_order_by_epic[epicId].filter((featureId) => responseData.entities.features[featureId]);\n                const sortedFeatures = featureIds.sort((aId, bId) => {\n                    const featureA = responseData.entities.features[aId];\n                    const featureB = responseData.entities.features[bId];\n                    if (!featureA || !featureB)\n                        return 0;\n                    const keyA = (0,_utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__.naturalSortKey)(featureA.title);\n                    const keyB = (0,_utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__.naturalSortKey)(featureB.title);\n                    return (0,_utils_naturalSort__WEBPACK_IMPORTED_MODULE_4__.compareNaturalSort)(keyA, keyB);\n                });\n                // 降順の場合は逆順\n                if (sortOptions.epic_sort_direction === 'desc') {\n                    sortedFeatures.reverse();\n                }\n                responseData.grid.feature_order_by_epic[epicId] = sortedFeatures;\n            });\n        }\n        // タイムスタンプ更新\n        responseData.metadata.timestamp = new Date().toISOString();\n        responseData.metadata.request_id = `req_${Math.random().toString(36).substring(7)}`;\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(responseData);\n    }),\n    // POST /api/epic_grid/projects/:projectId/grid/move_feature\n    // Feature移動処理\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/grid/move_feature', async ({ request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const body = (await request.json());\n        const { feature_id, target_epic_id, target_version_id } = body;\n        // Feature存在確認\n        const feature = currentData.entities.features[feature_id];\n        if (!feature) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Feature ${feature_id} not found`,\n                    details: {\n                        field: 'feature_id'\n                    }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // Epic存在確認\n        const targetEpic = currentData.entities.epics[target_epic_id];\n        if (!targetEpic) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Epic ${target_epic_id} not found`,\n                    details: {\n                        field: 'target_epic_id'\n                    }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        const oldEpicId = feature.parent_epic_id;\n        const oldVersionId = feature.fixed_version_id;\n        // feature_order_by_epicを更新 (3D Grid対応)\n        // 古いEpicから削除\n        if (currentData.grid.feature_order_by_epic[oldEpicId]) {\n            currentData.grid.feature_order_by_epic[oldEpicId] =\n                currentData.grid.feature_order_by_epic[oldEpicId].filter(id => id !== feature_id);\n        }\n        // 新しいEpicに追加\n        if (!currentData.grid.feature_order_by_epic[target_epic_id]) {\n            currentData.grid.feature_order_by_epic[target_epic_id] = [];\n        }\n        currentData.grid.feature_order_by_epic[target_epic_id].push(feature_id);\n        // Featureエンティティ更新\n        feature.parent_epic_id = target_epic_id;\n        feature.fixed_version_id = target_version_id;\n        feature.updated_on = new Date().toISOString();\n        // grid.indexの全UserStoryセルを更新 (3D Grid対応)\n        const affectedIssueIds = [];\n        feature.user_story_ids.forEach(storyId => {\n            const story = currentData.entities.user_stories[storyId];\n            if (story) {\n                // 古いセルから削除\n                currentData.grid.version_order.forEach(vId => {\n                    const oldCellKey = `${oldEpicId}:${feature_id}:${vId}`;\n                    if (currentData.grid.index[oldCellKey]) {\n                        currentData.grid.index[oldCellKey] =\n                            currentData.grid.index[oldCellKey].filter(id => id !== storyId);\n                    }\n                });\n                // 新しいセルに追加\n                const newCellKey = `${target_epic_id}:${feature_id}:${target_version_id || 'none'}`;\n                if (!currentData.grid.index[newCellKey]) {\n                    currentData.grid.index[newCellKey] = [];\n                }\n                currentData.grid.index[newCellKey].push(storyId);\n                // UserStoryエンティティ更新\n                story.fixed_version_id = target_version_id;\n                story.version_source = target_version_id ? 'direct' : 'none';\n                story.updated_on = new Date().toISOString();\n                affectedIssueIds.push(storyId);\n                // Task/Test/Bug も更新\n                [...story.task_ids, ...story.test_ids, ...story.bug_ids].forEach(childId => {\n                    const task = currentData.entities.tasks[childId];\n                    const test = currentData.entities.tests[childId];\n                    const bug = currentData.entities.bugs[childId];\n                    if (task) {\n                        task.fixed_version_id = target_version_id;\n                        task.updated_on = new Date().toISOString();\n                        affectedIssueIds.push(childId);\n                    }\n                    if (test) {\n                        test.fixed_version_id = target_version_id;\n                        test.updated_on = new Date().toISOString();\n                        affectedIssueIds.push(childId);\n                    }\n                    if (bug) {\n                        bug.fixed_version_id = target_version_id;\n                        bug.updated_on = new Date().toISOString();\n                        affectedIssueIds.push(childId);\n                    }\n                });\n            }\n        });\n        // タイムスタンプ更新\n        lastUpdateTimestamp = new Date().toISOString();\n        // レスポンス構築\n        const response = {\n            success: true,\n            updated_entities: {\n                features: {\n                    [feature_id]: feature\n                }\n            },\n            updated_grid_index: currentData.grid.index,\n            propagation_result: {\n                affected_issue_ids: affectedIssueIds,\n                conflicts: []\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response);\n    }),\n    // GET /api/epic_grid/projects/:projectId/grid/updates\n    // 差分更新取得 (ポーリング用)\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.get('/api/epic_grid/projects/:projectId/grid/updates', async ({ request }) => {\n        const url = new URL(request.url);\n        const since = url.searchParams.get('since');\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(100);\n        // 実際のアプリでは since 以降の変更を抽出\n        // ここでは簡易実装\n        const hasChanges = since ? new Date(since) < new Date(lastUpdateTimestamp) : false;\n        const response = {\n            updated_entities: hasChanges ? {\n                features: currentData.entities.features\n            } : {},\n            deleted_entities: {},\n            grid_changes: hasChanges ? {\n                updated_cells: currentData.grid.index,\n                removed_cells: []\n            } : undefined,\n            current_timestamp: new Date().toISOString(),\n            has_changes: hasChanges\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response);\n    }),\n    // POST /api/epic_grid/projects/:projectId/grid/reset\n    // モックデータリセット (テスト用)\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/grid/reset', async () => {\n        currentData = JSON.parse(JSON.stringify(_normalized_mock_data__WEBPACK_IMPORTED_MODULE_3__.normalizedMockData));\n        lastUpdateTimestamp = new Date().toISOString();\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json({\n            success: true,\n            message: 'Mock data has been reset'\n        });\n    }),\n    // ========================================\n    // CRUD操作: Feature\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/cards\n    // Feature作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/cards', async ({ request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const body = (await request.json());\n        const { subject, description, parent_epic_id, fixed_version_id, assigned_to_id, priority_id } = body;\n        // Epic存在確認\n        const parentEpic = currentData.entities.epics[parent_epic_id];\n        if (!parentEpic) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Epic ${parent_epic_id} not found`,\n                    details: { field: 'parent_epic_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 新規Feature作成\n        const newFeatureId = `f-new-${Date.now()}`;\n        const newFeature = {\n            id: newFeatureId,\n            title: subject,\n            description: description || '',\n            status: 'open',\n            parent_epic_id,\n            user_story_ids: [],\n            fixed_version_id,\n            version_source: fixed_version_id ? 'direct' : 'none',\n            statistics: {\n                total_user_stories: 0,\n                completed_user_stories: 0,\n                total_child_items: 0,\n                child_items_by_type: { tasks: 0, tests: 0, bugs: 0 },\n                completion_percentage: 0\n            },\n            assigned_to_id,\n            priority_id,\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString(),\n            tracker_id: 2\n        };\n        // エンティティ追加\n        currentData.entities.features[newFeatureId] = newFeature;\n        // feature_order_by_epic更新 (3D Grid対応)\n        if (!currentData.grid.feature_order_by_epic[parent_epic_id]) {\n            currentData.grid.feature_order_by_epic[parent_epic_id] = [];\n        }\n        currentData.grid.feature_order_by_epic[parent_epic_id].push(newFeatureId);\n        // 親Epic更新\n        parentEpic.feature_ids.push(newFeatureId);\n        parentEpic.statistics.total_features += 1;\n        parentEpic.updated_on = new Date().toISOString();\n        // Version統計更新\n        if (fixed_version_id && currentData.entities.versions[fixed_version_id]) {\n            const version = currentData.entities.versions[fixed_version_id];\n            version.issue_count += 1;\n            version.statistics.total_issues += 1;\n            version.updated_on = new Date().toISOString();\n        }\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newFeature,\n                updated_entities: {\n                    epics: { [parent_epic_id]: parentEpic },\n                    features: { [newFeatureId]: newFeature },\n                    ...(fixed_version_id && currentData.entities.versions[fixed_version_id] ? {\n                        versions: { [fixed_version_id]: currentData.entities.versions[fixed_version_id] }\n                    } : {})\n                },\n                grid_updates: {\n                    index: currentData.grid.index,\n                    feature_order_by_epic: currentData.grid.feature_order_by_epic\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // ========================================\n    // CRUD操作: UserStory\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/cards/:featureId/user_stories\n    // UserStory作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/cards/:featureId/user_stories', async ({ params, request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const { featureId } = params;\n        const body = (await request.json());\n        const { subject, description, assigned_to_id, estimated_hours, fixed_version_id } = body;\n        // Feature存在確認\n        const parentFeature = currentData.entities.features[featureId];\n        if (!parentFeature) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Feature ${featureId} not found`,\n                    details: { field: 'parent_feature_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 新規UserStory作成\n        const newStoryId = `us-new-${Date.now()}`;\n        const newUserStory = {\n            id: newStoryId,\n            title: subject,\n            description: description || '',\n            status: 'open',\n            parent_feature_id: featureId,\n            task_ids: [],\n            test_ids: [],\n            bug_ids: [],\n            fixed_version_id: fixed_version_id || null, // クライアント指定を優先（未指定時はnull）\n            version_source: fixed_version_id ? 'direct' : 'none',\n            expansion_state: true,\n            statistics: {\n                total_tasks: 0,\n                completed_tasks: 0,\n                total_tests: 0,\n                passed_tests: 0,\n                total_bugs: 0,\n                resolved_bugs: 0,\n                completion_percentage: 0\n            },\n            assigned_to_id,\n            estimated_hours,\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString(),\n            tracker_id: 3\n        };\n        // エンティティ追加\n        currentData.entities.user_stories[newStoryId] = newUserStory;\n        // 親Feature更新\n        parentFeature.user_story_ids.push(newStoryId);\n        parentFeature.statistics.total_user_stories += 1;\n        parentFeature.updated_on = new Date().toISOString();\n        // grid.index更新 (3D Grid対応)\n        // Epic × Feature × Version の3次元セルにUserStoryを追加\n        // UserStory個別のVersionを使用（Featureは無関係）\n        const epicId = parentFeature.parent_epic_id;\n        const versionId = newUserStory.fixed_version_id || 'none';\n        const cellKey = `${epicId}:${featureId}:${versionId}`;\n        if (!currentData.grid.index[cellKey]) {\n            currentData.grid.index[cellKey] = [];\n        }\n        currentData.grid.index[cellKey].push(newStoryId);\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newUserStory,\n                updated_entities: {\n                    features: { [featureId]: parentFeature },\n                    user_stories: { [newStoryId]: newUserStory }\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // ========================================\n    // CRUD操作: Task\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/cards/user_stories/:userStoryId/tasks\n    // Task作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/cards/user_stories/:userStoryId/tasks', async ({ params, request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const { userStoryId } = params;\n        const body = (await request.json());\n        const { subject, description, assigned_to_id, estimated_hours } = body;\n        // UserStory存在確認\n        const parentStory = currentData.entities.user_stories[userStoryId];\n        if (!parentStory) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `UserStory ${userStoryId} not found`,\n                    details: { field: 'parent_user_story_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 新規Task作成\n        const newTaskId = `task-new-${Date.now()}`;\n        const newTask = {\n            id: newTaskId,\n            title: subject,\n            description: description || '',\n            status: 'open',\n            parent_user_story_id: userStoryId,\n            fixed_version_id: parentStory.fixed_version_id,\n            assigned_to_id,\n            estimated_hours,\n            spent_hours: 0,\n            done_ratio: 0,\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString(),\n            tracker_id: 4\n        };\n        // エンティティ追加\n        currentData.entities.tasks[newTaskId] = newTask;\n        // 親UserStory更新\n        parentStory.task_ids.push(newTaskId);\n        parentStory.statistics.total_tasks += 1;\n        parentStory.updated_on = new Date().toISOString();\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newTask,\n                updated_entities: {\n                    user_stories: { [userStoryId]: parentStory },\n                    tasks: { [newTaskId]: newTask }\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // ========================================\n    // CRUD操作: Test\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/cards/user_stories/:userStoryId/tests\n    // Test作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/cards/user_stories/:userStoryId/tests', async ({ params, request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const { userStoryId } = params;\n        const body = (await request.json());\n        const { subject, description, assigned_to_id } = body;\n        // UserStory存在確認\n        const parentStory = currentData.entities.user_stories[userStoryId];\n        if (!parentStory) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `UserStory ${userStoryId} not found`,\n                    details: { field: 'parent_user_story_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 新規Test作成\n        const newTestId = `test-new-${Date.now()}`;\n        const newTest = {\n            id: newTestId,\n            title: subject,\n            description: description || '',\n            status: 'open',\n            parent_user_story_id: userStoryId,\n            fixed_version_id: parentStory.fixed_version_id,\n            test_result: 'pending',\n            assigned_to_id,\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString(),\n            tracker_id: 5\n        };\n        // エンティティ追加\n        currentData.entities.tests[newTestId] = newTest;\n        // 親UserStory更新\n        parentStory.test_ids.push(newTestId);\n        parentStory.statistics.total_tests += 1;\n        parentStory.updated_on = new Date().toISOString();\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newTest,\n                updated_entities: {\n                    user_stories: { [userStoryId]: parentStory },\n                    tests: { [newTestId]: newTest }\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // ========================================\n    // CRUD操作: Bug\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/cards/user_stories/:userStoryId/bugs\n    // Bug作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/cards/user_stories/:userStoryId/bugs', async ({ params, request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const { userStoryId } = params;\n        const body = (await request.json());\n        const { subject, description, assigned_to_id, severity } = body;\n        // UserStory存在確認\n        const parentStory = currentData.entities.user_stories[userStoryId];\n        if (!parentStory) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `UserStory ${userStoryId} not found`,\n                    details: { field: 'parent_user_story_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 新規Bug作成\n        const newBugId = `bug-new-${Date.now()}`;\n        const newBug = {\n            id: newBugId,\n            title: subject,\n            description: description || '',\n            status: 'open',\n            parent_user_story_id: userStoryId,\n            fixed_version_id: parentStory.fixed_version_id,\n            severity: severity || 'minor',\n            assigned_to_id,\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString(),\n            tracker_id: 6\n        };\n        // エンティティ追加\n        currentData.entities.bugs[newBugId] = newBug;\n        // 親UserStory更新\n        parentStory.bug_ids.push(newBugId);\n        parentStory.statistics.total_bugs += 1;\n        parentStory.updated_on = new Date().toISOString();\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newBug,\n                updated_entities: {\n                    user_stories: { [userStoryId]: parentStory },\n                    bugs: { [newBugId]: newBug }\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // ========================================\n    // CRUD操作: Epic\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/epics\n    // Epic作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/epics', async ({ params, request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const body = (await request.json());\n        const { subject, description, fixed_version_id, status } = body;\n        // バリデーション: subject必須\n        if (!subject || subject.trim() === '') {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'validation_error',\n                    message: 'Epic subject is required',\n                    details: {\n                        field: 'subject',\n                        validation_errors: [{\n                                field: 'subject',\n                                message: 'Subject cannot be blank',\n                                code: 'blank'\n                            }]\n                    }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 400 });\n        }\n        // 新規Epic作成\n        const newEpicId = `epic-new-${Date.now()}`;\n        const newEpic = {\n            id: newEpicId,\n            subject: subject.trim(),\n            description: description || '',\n            status: status || 'open',\n            fixed_version_id: fixed_version_id || null,\n            feature_ids: [],\n            statistics: {\n                total_features: 0,\n                completed_features: 0,\n                total_user_stories: 0,\n                total_child_items: 0,\n                completion_percentage: 0\n            },\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString(),\n            tracker_id: 1\n        };\n        // エンティティ追加\n        currentData.entities.epics[newEpicId] = newEpic;\n        // グリッド順序更新 (新しいEpicを最後に追加)\n        if (!currentData.grid.epic_order.includes(newEpicId)) {\n            currentData.grid.epic_order.push(newEpicId);\n        }\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newEpic,\n                updated_entities: {\n                    epics: { [newEpicId]: newEpic }\n                },\n                grid_updates: {\n                    epic_order: currentData.grid.epic_order\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // ========================================\n    // CRUD操作: Version\n    // ========================================\n    // POST /api/epic_grid/projects/:projectId/versions\n    // Version作成\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/versions', async ({ params, request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const body = (await request.json());\n        const { name, description, effective_date, status } = body;\n        // バリデーション: name必須\n        if (!name || name.trim() === '') {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'validation_error',\n                    message: 'Version name is required',\n                    details: {\n                        field: 'name',\n                        validation_errors: [{\n                                field: 'name',\n                                message: 'Name cannot be blank',\n                                code: 'blank'\n                            }]\n                    }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 400 });\n        }\n        // 新規Version作成\n        const newVersionId = `v-new-${Date.now()}`;\n        const newVersion = {\n            id: newVersionId,\n            name: name.trim(),\n            description: description || '',\n            effective_date,\n            status: status || 'open',\n            issue_count: 0,\n            statistics: {\n                total_issues: 0,\n                completed_issues: 0,\n                completion_rate: 0\n            },\n            created_on: new Date().toISOString(),\n            updated_on: new Date().toISOString()\n        };\n        // エンティティ追加\n        currentData.entities.versions[newVersionId] = newVersion;\n        // グリッド順序更新 (新しいVersionを最後に追加)\n        if (!currentData.grid.version_order.includes(newVersionId)) {\n            currentData.grid.version_order.push(newVersionId);\n        }\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                created_entity: newVersion,\n                updated_entities: {\n                    versions: { [newVersionId]: newVersion }\n                },\n                grid_updates: {\n                    version_order: currentData.grid.version_order\n                }\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response, { status: 201 });\n    }),\n    // POST /api/epic_grid/projects/:projectId/grid/reorder_epics\n    // Epic並び替え処理\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/grid/reorder_epics', async ({ request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(100);\n        const body = (await request.json());\n        const { source_epic_id, target_epic_id, position } = body;\n        // Epic存在確認\n        if (!currentData.entities.epics[source_epic_id]) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Epic ${source_epic_id} not found`,\n                    details: { field: 'source_epic_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        if (!currentData.entities.epics[target_epic_id]) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Epic ${target_epic_id} not found`,\n                    details: { field: 'target_epic_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 並び替え実行\n        const epicOrder = currentData.grid.epic_order;\n        const sourceIndex = epicOrder.indexOf(source_epic_id);\n        const targetIndex = epicOrder.indexOf(target_epic_id);\n        if (sourceIndex !== -1) {\n            epicOrder.splice(sourceIndex, 1);\n        }\n        const newTargetIndex = epicOrder.indexOf(target_epic_id);\n        const insertPosition = position === 'before' ? newTargetIndex : newTargetIndex + 1;\n        epicOrder.splice(insertPosition, 0, source_epic_id);\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                epic_order: currentData.grid.epic_order\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response);\n    }),\n    // POST /api/epic_grid/projects/:projectId/grid/reorder_versions\n    // Version並び替え処理\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/grid/reorder_versions', async ({ request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(100);\n        const body = (await request.json());\n        const { source_version_id, target_version_id, position } = body;\n        // Version存在確認\n        if (!currentData.entities.versions[source_version_id]) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Version ${source_version_id} not found`,\n                    details: { field: 'source_version_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        if (!currentData.entities.versions[target_version_id]) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Version ${target_version_id} not found`,\n                    details: { field: 'target_version_id' }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // 並び替え実行\n        const versionOrder = currentData.grid.version_order;\n        const sourceIndex = versionOrder.indexOf(source_version_id);\n        const targetIndex = versionOrder.indexOf(target_version_id);\n        if (sourceIndex !== -1) {\n            versionOrder.splice(sourceIndex, 1);\n        }\n        const newTargetIndex = versionOrder.indexOf(target_version_id);\n        const insertPosition = position === 'before' ? newTargetIndex : newTargetIndex + 1;\n        versionOrder.splice(insertPosition, 0, source_version_id);\n        lastUpdateTimestamp = new Date().toISOString();\n        const response = {\n            success: true,\n            data: {\n                version_order: currentData.grid.version_order\n            },\n            meta: {\n                timestamp: new Date().toISOString(),\n                request_id: `req_${Math.random().toString(36).substring(7)}`\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response);\n    }),\n    // POST /api/epic_grid/projects/:projectId/grid/move_user_story\n    // UserStory移動処理\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/grid/move_user_story', async ({ request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(200);\n        const body = (await request.json());\n        const { user_story_id, target_feature_id, target_version_id } = body;\n        // UserStory存在確認\n        const userStory = currentData.entities.user_stories[user_story_id];\n        if (!userStory) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `UserStory ${user_story_id} not found`,\n                    details: {\n                        field: 'user_story_id'\n                    }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        // Feature存在確認\n        const targetFeature = currentData.entities.features[target_feature_id];\n        if (!targetFeature) {\n            const errorResponse = {\n                success: false,\n                error: {\n                    code: 'not_found',\n                    message: `Feature ${target_feature_id} not found`,\n                    details: {\n                        field: 'target_feature_id'\n                    }\n                },\n                metadata: {\n                    timestamp: new Date().toISOString(),\n                    request_id: `req_${Math.random().toString(36).substring(7)}`\n                }\n            };\n            return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(errorResponse, { status: 404 });\n        }\n        const oldFeatureId = userStory.parent_feature_id;\n        const oldVersionId = userStory.fixed_version_id;\n        const oldFeature = currentData.entities.features[oldFeatureId];\n        // 古いFeatureからUserStoryを削除\n        if (oldFeature) {\n            oldFeature.user_story_ids = oldFeature.user_story_ids.filter(id => id !== user_story_id);\n            oldFeature.statistics.total_user_stories -= 1;\n            oldFeature.updated_on = new Date().toISOString();\n        }\n        // 新しいFeatureにUserStoryを追加\n        if (!targetFeature.user_story_ids.includes(user_story_id)) {\n            targetFeature.user_story_ids.push(user_story_id);\n            targetFeature.statistics.total_user_stories += 1;\n        }\n        targetFeature.updated_on = new Date().toISOString();\n        // UserStoryエンティティ更新\n        userStory.parent_feature_id = target_feature_id;\n        userStory.fixed_version_id = target_version_id;\n        userStory.version_source = 'direct';\n        userStory.updated_on = new Date().toISOString();\n        // grid.indexを更新 (3D Grid対応)\n        const affectedIssueIds = [user_story_id];\n        // 古いセルから削除\n        currentData.grid.version_order.forEach(vId => {\n            const oldEpicId = oldFeature?.parent_epic_id;\n            if (oldEpicId) {\n                const oldCellKey = `${oldEpicId}:${oldFeatureId}:${vId}`;\n                if (currentData.grid.index[oldCellKey]) {\n                    currentData.grid.index[oldCellKey] = currentData.grid.index[oldCellKey].filter(id => id !== user_story_id);\n                }\n            }\n        });\n        // 新しいセルに追加\n        const newEpicId = targetFeature.parent_epic_id;\n        const newCellKey = `${newEpicId}:${target_feature_id}:${target_version_id || 'none'}`;\n        if (!currentData.grid.index[newCellKey]) {\n            currentData.grid.index[newCellKey] = [];\n        }\n        if (!currentData.grid.index[newCellKey].includes(user_story_id)) {\n            currentData.grid.index[newCellKey].push(user_story_id);\n        }\n        // Task/Test/Bug も更新\n        [...userStory.task_ids, ...userStory.test_ids, ...userStory.bug_ids].forEach(childId => {\n            const task = currentData.entities.tasks[childId];\n            const test = currentData.entities.tests[childId];\n            const bug = currentData.entities.bugs[childId];\n            if (task) {\n                task.fixed_version_id = target_version_id;\n                task.updated_on = new Date().toISOString();\n                affectedIssueIds.push(childId);\n            }\n            if (test) {\n                test.fixed_version_id = target_version_id;\n                test.updated_on = new Date().toISOString();\n                affectedIssueIds.push(childId);\n            }\n            if (bug) {\n                bug.fixed_version_id = target_version_id;\n                bug.updated_on = new Date().toISOString();\n                affectedIssueIds.push(childId);\n            }\n        });\n        // タイムスタンプ更新\n        lastUpdateTimestamp = new Date().toISOString();\n        // 部分的なグリッドインデックス更新を構築 (バックエンドと同じ動作)\n        const partialGridIndex = {};\n        // 古いセルの更新された値を追加\n        currentData.grid.version_order.forEach(vId => {\n            const oldEpicId = oldFeature?.parent_epic_id;\n            if (oldEpicId) {\n                const oldCellKey = `${oldEpicId}:${oldFeatureId}:${vId}`;\n                if (currentData.grid.index[oldCellKey]) {\n                    partialGridIndex[oldCellKey] = currentData.grid.index[oldCellKey];\n                }\n            }\n        });\n        // 新しいセルを追加 (既に上で定義済みの変数を再利用)\n        partialGridIndex[newCellKey] = currentData.grid.index[newCellKey];\n        // レスポンス構築\n        const response = {\n            success: true,\n            updated_entities: {\n                user_stories: {\n                    [user_story_id]: userStory\n                },\n                features: {\n                    [target_feature_id]: targetFeature,\n                    ...(oldFeature ? { [oldFeatureId]: oldFeature } : {})\n                }\n            },\n            updated_grid_index: partialGridIndex,\n            propagation_result: {\n                affected_issue_ids: affectedIssueIds,\n                conflicts: []\n            }\n        };\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response);\n    }),\n    // POST /api/epic_grid/projects/:projectId/grid/batch_update\n    // バッチ更新処理（D&D操作の一括保存）\n    msw__WEBPACK_IMPORTED_MODULE_0__.http.post('/api/epic_grid/projects/:projectId/grid/batch_update', async ({ request }) => {\n        await (0,msw__WEBPACK_IMPORTED_MODULE_2__.delay)(300); // API遅延シミュレート\n        const body = await request.json();\n        console.log('📦 MSW: batch_update called:', body);\n        const updatedEntities = {};\n        const updatedGridIndex = {};\n        // ========================================\n        // UserStory移動の一括処理\n        // ========================================\n        if (body.moved_user_stories && body.moved_user_stories.length > 0) {\n            const userStories = {};\n            const features = {};\n            body.moved_user_stories.forEach(move => {\n                const { id: userStoryId, target_feature_id, target_version_id } = move;\n                const userStory = currentData.entities.user_stories[userStoryId];\n                if (!userStory) {\n                    console.error(`❌ UserStory not found: ${userStoryId}`);\n                    return;\n                }\n                const oldFeatureId = userStory.parent_feature_id;\n                const oldFeature = currentData.entities.features[oldFeatureId];\n                const targetFeature = currentData.entities.features[target_feature_id];\n                if (!targetFeature) {\n                    console.error(`❌ Target feature not found: ${target_feature_id}`);\n                    return;\n                }\n                // UserStoryの移動処理（move_user_storyのロジックを再利用）\n                const oldVersionId = userStory.fixed_version_id;\n                // 古いFeatureから削除\n                if (oldFeature) {\n                    oldFeature.user_story_ids = oldFeature.user_story_ids.filter(id => id !== userStoryId);\n                    features[oldFeatureId] = oldFeature;\n                }\n                // 新しいFeatureに追加\n                if (!targetFeature.user_story_ids.includes(userStoryId)) {\n                    targetFeature.user_story_ids.push(userStoryId);\n                }\n                features[target_feature_id] = targetFeature;\n                // UserStory更新\n                userStory.parent_feature_id = target_feature_id;\n                userStory.fixed_version_id = target_version_id;\n                userStories[userStoryId] = userStory;\n                // Grid index更新（全versionに対して処理）\n                const oldEpicId = oldFeature?.parent_epic_id;\n                const newEpicId = targetFeature.parent_epic_id;\n                currentData.grid.version_order.forEach(vId => {\n                    // 古いセルの更新\n                    if (oldEpicId && oldFeature) {\n                        const oldCellKey = `${oldEpicId}:${oldFeatureId}:${vId}`;\n                        if (currentData.grid.index[oldCellKey]) {\n                            currentData.grid.index[oldCellKey] = currentData.grid.index[oldCellKey].filter(id => id !== userStoryId);\n                            updatedGridIndex[oldCellKey] = currentData.grid.index[oldCellKey];\n                        }\n                    }\n                    // 新しいセルの更新\n                    const newCellKey = `${newEpicId}:${target_feature_id}:${vId}`;\n                    if (vId === (target_version_id || 'none')) {\n                        if (!currentData.grid.index[newCellKey]) {\n                            currentData.grid.index[newCellKey] = [];\n                        }\n                        if (!currentData.grid.index[newCellKey].includes(userStoryId)) {\n                            currentData.grid.index[newCellKey].push(userStoryId);\n                        }\n                        updatedGridIndex[newCellKey] = currentData.grid.index[newCellKey];\n                    }\n                });\n                console.log(`✅ Moved UserStory ${userStoryId} → Feature ${target_feature_id}, Version ${target_version_id}`);\n            });\n            updatedEntities.user_stories = userStories;\n            updatedEntities.features = features;\n        }\n        // ========================================\n        // Epic並び替え\n        // ========================================\n        let updatedEpicOrder;\n        if (body.reordered_epics) {\n            currentData.grid.epic_order = [...body.reordered_epics];\n            updatedEpicOrder = [...body.reordered_epics];\n            console.log('✅ Reordered Epics:', updatedEpicOrder);\n        }\n        // ========================================\n        // Version並び替え\n        // ========================================\n        let updatedVersionOrder;\n        if (body.reordered_versions) {\n            currentData.grid.version_order = [...body.reordered_versions];\n            updatedVersionOrder = [...body.reordered_versions];\n            console.log('✅ Reordered Versions:', updatedVersionOrder);\n        }\n        // レスポンス構築\n        const response = {\n            success: true,\n            updated_entities: updatedEntities,\n            updated_grid_index: updatedGridIndex,\n            updated_epic_order: updatedEpicOrder,\n            updated_version_order: updatedVersionOrder\n        };\n        lastUpdateTimestamp = new Date().toISOString();\n        console.log('📦 MSW: batch_update response:', response);\n        return msw__WEBPACK_IMPORTED_MODULE_1__.HttpResponse.json(response);\n    })\n];\n// ========================================\n// デバッグ用ヘルパー\n// ========================================\n// 現在のモックデータ状態を取得 (開発ツール用)\nconst getCurrentMockData = () => JSON.parse(JSON.stringify(currentData));\n// モックデータを手動更新 (開発ツール用)\nconst setMockData = (data) => {\n    currentData = JSON.parse(JSON.stringify(data));\n    lastUpdateTimestamp = new Date().toISOString();\n};\n\n\n//# sourceURL=webpack://redmine_epic_grid/./assets/javascripts/epic_grid/src/mocks/handlers.ts?\n}");

/***/ }),

/***/ "./assets/javascripts/epic_grid/src/utils/naturalSort.ts":
/*!***************************************************************!*\
  !*** ./assets/javascripts/epic_grid/src/utils/naturalSort.ts ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   compareNaturalSort: () => (/* binding */ compareNaturalSort),\n/* harmony export */   naturalSortKey: () => (/* binding */ naturalSortKey)\n/* harmony export */ });\n/**\n * 自然順ソートキー生成（Ruby実装と同等）\n * 文字列を数値部分と非数値部分に分割し、比較可能な形式に変換\n *\n * @example\n * naturalSortKey(\"10_サーバ構築\") // => [[0, 10], [1, \"_サーバ構築\"]]\n * naturalSortKey(\"10_test_20_final\") // => [[0, 10], [1, \"_test_\"], [0, 20], [1, \"_final\"]]\n *\n * @param str - ソート対象の文字列\n * @returns [type, value]の配列。typeは0=数値、1=文字列\n */\nfunction naturalSortKey(str) {\n    const parts = str.match(/(\\d+|\\D+)/g) || [];\n    return parts.map(part => {\n        if (/^\\d+$/.test(part)) {\n            return [0, parseInt(part, 10)];\n        }\n        else {\n            return [1, part];\n        }\n    });\n}\n/**\n * 自然順ソート比較関数\n * naturalSortKeyで生成されたソートキーを比較\n *\n * @example\n * const keys = [\n *   naturalSortKey(\"100_ユーザ管理\"),\n *   naturalSortKey(\"10_サーバ構築\"),\n *   naturalSortKey(\"2_認証機能\")\n * ];\n * keys.sort(compareNaturalSort);\n * // => [\"2_認証機能\", \"10_サーバ構築\", \"100_ユーザ管理\"]\n *\n * @param a - 比較対象のソートキーA\n * @param b - 比較対象のソートキーB\n * @returns -1, 0, 1（標準的なソート比較関数の戻り値）\n */\nfunction compareNaturalSort(a, b) {\n    const minLength = Math.min(a.length, b.length);\n    for (let i = 0; i < minLength; i++) {\n        const [typeA, valueA] = a[i];\n        const [typeB, valueB] = b[i];\n        // Type flag比較（数値=0が文字列=1より優先）\n        if (typeA !== typeB) {\n            return typeA - typeB;\n        }\n        // 同じタイプの場合は値を比較\n        if (valueA < valueB)\n            return -1;\n        if (valueA > valueB)\n            return 1;\n    }\n    // 全て同じ場合は長さで比較\n    return a.length - b.length;\n}\n\n\n//# sourceURL=webpack://redmine_epic_grid/./assets/javascripts/epic_grid/src/utils/naturalSort.ts?\n}");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("ab68c5ef35eecb9be4c2")
/******/ })();
/******/ 
/******/ }
);
const PACKAGE_VERSION="2.11.3",INTEGRITY_CHECKSUM="4db4a41e972cec1b64cc569c66952d82",IS_MOCKED_RESPONSE=Symbol("isMockedResponse"),activeClientIds=new Set;async function handleRequest(e,t,n){const s=await resolveMainClient(e),i=e.request.clone(),a=await getResponse(e,s,t,n);if(s&&activeClientIds.has(s.id)){const e=await serializeRequest(i),n=a.clone();sendToClient(s,{type:"RESPONSE",payload:{isMockedResponse:IS_MOCKED_RESPONSE in a,request:{id:t,...e},response:{type:n.type,status:n.status,statusText:n.statusText,headers:Object.fromEntries(n.headers.entries()),body:n.body}}},n.body?[e.body,n.body]:[])}return a}async function resolveMainClient(e){const t=await self.clients.get(e.clientId);return activeClientIds.has(e.clientId)||"top-level"===t?.frameType?t:(await self.clients.matchAll({type:"window"})).filter(e=>"visible"===e.visibilityState).find(e=>activeClientIds.has(e.id))}async function getResponse(e,t,n,s){const i=e.request.clone();function a(){const e=new Headers(i.headers),t=e.get("accept");if(t){const n=t.split(",").map(e=>e.trim()).filter(e=>"msw/passthrough"!==e);n.length>0?e.set("accept",n.join(", ")):e.delete("accept")}return fetch(i,{headers:e})}if(!t)return a();if(!activeClientIds.has(t.id))return a();const r=await serializeRequest(e.request),c=await sendToClient(t,{type:"REQUEST",payload:{id:n,interceptedAt:s,...r}},[r.body]);switch(c.type){case"MOCK_RESPONSE":return respondWithMock(c.data);case"PASSTHROUGH":return a()}return a()}function sendToClient(e,t,n=[]){return new Promise((s,i)=>{const a=new MessageChannel;a.port1.onmessage=e=>{if(e.data&&e.data.error)return i(e.data.error);s(e.data)},e.postMessage(t,[a.port2,...n.filter(Boolean)])})}function respondWithMock(e){if(0===e.status)return Response.error();const t=new Response(e.body,e);return Reflect.defineProperty(t,IS_MOCKED_RESPONSE,{value:!0,enumerable:!0}),t}async function serializeRequest(e){return{url:e.url,mode:e.mode,method:e.method,headers:Object.fromEntries(e.headers.entries()),cache:e.cache,credentials:e.credentials,destination:e.destination,integrity:e.integrity,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy,body:await e.arrayBuffer(),keepalive:e.keepalive}}addEventListener("install",function(){self.skipWaiting()}),addEventListener("activate",function(e){e.waitUntil(self.clients.claim())}),addEventListener("message",async function(e){const t=Reflect.get(e.source||{},"id");if(!t||!self.clients)return;const n=await self.clients.get(t);if(!n)return;const s=await self.clients.matchAll({type:"window"});switch(e.data){case"KEEPALIVE_REQUEST":sendToClient(n,{type:"KEEPALIVE_RESPONSE"});break;case"INTEGRITY_CHECK_REQUEST":sendToClient(n,{type:"INTEGRITY_CHECK_RESPONSE",payload:{packageVersion:"2.11.3",checksum:INTEGRITY_CHECKSUM}});break;case"MOCK_ACTIVATE":activeClientIds.add(t),sendToClient(n,{type:"MOCKING_ENABLED",payload:{client:{id:n.id,frameType:n.frameType}}});break;case"CLIENT_CLOSED":{activeClientIds.delete(t);const e=s.filter(e=>e.id!==t);0===e.length&&self.registration.unregister();break}}}),addEventListener("fetch",function(e){const t=Date.now();if("navigate"===e.request.mode)return;if("only-if-cached"===e.request.cache&&"same-origin"!==e.request.mode)return;if(0===activeClientIds.size)return;const n=crypto.randomUUID();e.respondWith(handleRequest(e,n,t))});
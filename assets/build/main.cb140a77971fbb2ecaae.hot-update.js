"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdateredmine_epic_grid"]("main",{

/***/ "./assets/javascripts/epic_grid/src/components/IssueDetail/DetailPane.tsx":
/*!********************************************************************************!*\
  !*** ./assets/javascripts/epic_grid/src/components/IssueDetail/DetailPane.tsx ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DetailPane: () => (/* binding */ DetailPane)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./assets/javascripts/epic_grid/node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _store_useStore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../store/useStore */ \"./assets/javascripts/epic_grid/src/store/useStore.ts\");\n\n\n/**\n * 詳細ペインコンポーネント（汎用）\n * RedmineのIssue/Version詳細ページをiframeで表示\n */\nconst DetailPane = ({ entity, projectId, }) => {\n    const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n    const iframeRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const previousEntityRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(entity);\n    const loadTimeoutRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    // Zustand storeからVersionデータ取得（タイトル表示用）\n    const versions = (0,_store_useStore__WEBPACK_IMPORTED_MODULE_1__.useStore)(state => state.entities.versions);\n    // iframeのURL生成（汎用化）\n    const getIframeUrl = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n        if (!entity)\n            return null;\n        switch (entity.type) {\n            case 'issue':\n                return `/issues/${entity.id}`;\n            case 'version':\n                return `/versions/${entity.id}`;\n            default:\n                return null;\n        }\n    }, [entity]);\n    // タイトル生成（汎用化）\n    const getTitle = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n        if (!entity)\n            return '';\n        switch (entity.type) {\n            case 'issue':\n                return `チケット #${entity.id}`;\n            case 'version': {\n                const version = versions[entity.id];\n                return version ? `バージョン: ${version.name}` : `バージョン #${entity.id}`;\n            }\n            default:\n                return '';\n        }\n    }, [entity, versions]);\n    // Entity IDが変更されたときの処理\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n        if (entity !== previousEntityRef.current) {\n            previousEntityRef.current = entity;\n        }\n        if (entity) {\n            setIsLoading(true);\n            setError(null);\n            // 既存のタイムアウトをクリア\n            if (loadTimeoutRef.current) {\n                clearTimeout(loadTimeoutRef.current);\n            }\n            // 3秒経過してもiframeのonLoadが発火しない場合、強制的にローディング解除\n            loadTimeoutRef.current = setTimeout(() => {\n                setIsLoading(false);\n                loadTimeoutRef.current = null;\n            }, 3000);\n            return () => {\n                if (loadTimeoutRef.current) {\n                    clearTimeout(loadTimeoutRef.current);\n                    loadTimeoutRef.current = null;\n                }\n            };\n        }\n    }, [entity]);\n    // iframeの読み込み完了処理\n    const handleIframeLoad = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n        // タイムアウトをクリア（正常に読み込まれた場合）\n        if (loadTimeoutRef.current) {\n            clearTimeout(loadTimeoutRef.current);\n            loadTimeoutRef.current = null;\n        }\n        setIsLoading(false);\n        // iframe内のナビゲーションを監視\n        try {\n            const iframe = iframeRef.current;\n            if (iframe && iframe.contentWindow) {\n                // Same-origin policyの制約内で可能な処理\n                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;\n                // Redmineのスタイル調整（必要に応じて）\n                const style = iframeDoc.createElement('style');\n                style.textContent = `\n          /* 2ペインモード用のスタイル調整 */\n          #header, #top-menu { display: none; }\n          #main { padding: 10px; }\n          #content { margin: 0; }\n          .contextual { position: sticky; top: 0; background: white; z-index: 10; }\n        `;\n                iframeDoc.head.appendChild(style);\n            }\n        }\n        catch (e) {\n            // Same-origin policyエラーは無視\n            console.debug('Same-origin policy制約により、iframe内のスタイル調整をスキップ');\n        }\n    }, []);\n    // iframeのエラー処理\n    const handleIframeError = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n        setIsLoading(false);\n        setError('詳細の読み込みに失敗しました');\n    }, []);\n    // リロードボタンのハンドラ\n    const handleReload = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {\n        if (iframeRef.current) {\n            setIsLoading(true);\n            setError(null);\n            const url = getIframeUrl();\n            if (url) {\n                iframeRef.current.src = url + '?t=' + Date.now();\n            }\n        }\n    }, [getIframeUrl]);\n    if (!entity) {\n        return (react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane issue-detail-pane--empty\" },\n            react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__placeholder\" },\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"svg\", { className: \"issue-detail-pane__placeholder-icon\", width: \"64\", height: \"64\", viewBox: \"0 0 64 64\", fill: \"none\" },\n                    react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"path\", { d: \"M22 16h20M22 32h20M22 48h12\", stroke: \"#ccc\", strokeWidth: \"2\", strokeLinecap: \"round\" }),\n                    react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"rect\", { x: \"8\", y: \"8\", width: \"48\", height: \"48\", rx: \"4\", stroke: \"#ccc\", strokeWidth: \"2\", fill: \"none\" })),\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", { className: \"issue-detail-pane__placeholder-text\" }, \"\\u30C1\\u30B1\\u30C3\\u30C8\\u307E\\u305F\\u306F\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u3092\\u9078\\u629E\\u3059\\u308B\\u3068\\u8A73\\u7D30\\u304C\\u8868\\u793A\\u3055\\u308C\\u307E\\u3059\"))));\n    }\n    const iframeUrl = getIframeUrl();\n    const title = getTitle();\n    return (react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane\" },\n        react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__header\" },\n            react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h3\", { className: \"issue-detail-pane__title\" }, title),\n            react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__actions\" },\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", { className: \"issue-detail-pane__reload\", onClick: handleReload, title: \"\\u518D\\u8AAD\\u307F\\u8FBC\\u307F\" },\n                    react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"svg\", { width: \"16\", height: \"16\", viewBox: \"0 0 16 16\", fill: \"none\" },\n                        react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"path\", { d: \"M14 8a6 6 0 11-1.5-4\", stroke: \"currentColor\", strokeWidth: \"1.5\", strokeLinecap: \"round\" }),\n                        react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"path\", { d: \"M12.5 4L14 2.5V5.5H11\", stroke: \"currentColor\", strokeWidth: \"1.5\", strokeLinecap: \"round\", strokeLinejoin: \"round\" }))))),\n        react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__content\" },\n            isLoading && (react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__loading\" },\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__spinner\" }),\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, \"\\u8AAD\\u307F\\u8FBC\\u307F\\u4E2D...\"))),\n            error && (react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", { className: \"issue-detail-pane__error\" },\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, error),\n                react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", { onClick: handleReload }, \"\\u518D\\u8A66\\u884C\"))),\n            iframeUrl && (react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"iframe\", { ref: iframeRef, className: \"issue-detail-pane__iframe\", src: iframeUrl, onLoad: handleIframeLoad, onError: handleIframeError, title: title, style: { display: isLoading || error ? 'none' : 'block' } })))));\n};\n\n\n//# sourceURL=webpack://redmine_epic_grid/./assets/javascripts/epic_grid/src/components/IssueDetail/DetailPane.tsx?\n}");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("762302dce56c47c9ce05")
/******/ })();
/******/ 
/******/ }
);
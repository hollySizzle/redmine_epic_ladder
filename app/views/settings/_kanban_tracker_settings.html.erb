<div class="box tabular settings">
  <h3>ãƒˆãƒ©ãƒƒã‚«ãƒ¼è¨­å®š</h3>
  <p class="description">
    å„éšå±¤ãƒ¬ãƒ™ãƒ«ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ©ãƒƒã‚«ãƒ¼åã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚<br>
    ã“ã“ã§è¨­å®šã—ãŸãƒˆãƒ©ãƒƒã‚«ãƒ¼åã¨ä¸€è‡´ã™ã‚‹ãƒˆãƒ©ãƒƒã‚«ãƒ¼ãŒRedmineã«å­˜åœ¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
  </p>

  <div class="splitcontent">
    <div class="splitcontentleft">
      <fieldset class="box">
        <legend>éšå±¤ãƒˆãƒ©ãƒƒã‚«ãƒ¼è¨­å®š</legend>

        <p>
          <label for="settings_epic_tracker">Epic (ãƒ¬ãƒ™ãƒ«1)</label>
          <%= select_tag 'settings[epic_tracker]',
              options_from_collection_for_select(Tracker.sorted, :name, :name,
                                                 @settings['epic_tracker']),
              { include_blank: '-- é¸æŠã—ã¦ãã ã•ã„ --', class: 'tracker-select' } %>
          <em class="info">æœ€ä¸Šä½ã®å¤§ããªæ©Ÿèƒ½å˜ä½</em>
        </p>

        <p>
          <label for="settings_feature_tracker">Feature (ãƒ¬ãƒ™ãƒ«2)</label>
          <%= select_tag 'settings[feature_tracker]',
              options_from_collection_for_select(Tracker.sorted, :name, :name,
                                                 @settings['feature_tracker']),
              { include_blank: '-- é¸æŠã—ã¦ãã ã•ã„ --', class: 'tracker-select' } %>
          <em class="info">æ©Ÿèƒ½å˜ä½ï¼ˆEpicã®å­è¦ç´ ï¼‰</em>
        </p>

        <p>
          <label for="settings_user_story_tracker">UserStory (ãƒ¬ãƒ™ãƒ«3)</label>
          <%= select_tag 'settings[user_story_tracker]',
              options_from_collection_for_select(Tracker.sorted, :name, :name,
                                                 @settings['user_story_tracker']),
              { include_blank: '-- é¸æŠã—ã¦ãã ã•ã„ --', class: 'tracker-select' } %>
          <em class="info">ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ã®è¦ä»¶ï¼ˆFeatureã®å­è¦ç´ ï¼‰</em>
        </p>
      </fieldset>
    </div>

    <div class="splitcontentright">
      <fieldset class="box">
        <legend>å®Ÿè£…ãƒˆãƒ©ãƒƒã‚«ãƒ¼è¨­å®š</legend>

        <p>
          <label for="settings_task_tracker">Task (ãƒ¬ãƒ™ãƒ«4)</label>
          <%= select_tag 'settings[task_tracker]',
              options_from_collection_for_select(Tracker.sorted, :name, :name,
                                                 @settings['task_tracker']),
              { include_blank: '-- é¸æŠã—ã¦ãã ã•ã„ --', class: 'tracker-select' } %>
          <em class="info">å®Ÿè£…ã‚¿ã‚¹ã‚¯ï¼ˆUserStoryã®å­è¦ç´ ï¼‰</em>
        </p>

        <p>
          <label for="settings_test_tracker">Test (ãƒ¬ãƒ™ãƒ«4)</label>
          <%= select_tag 'settings[test_tracker]',
              options_from_collection_for_select(Tracker.sorted, :name, :name,
                                                 @settings['test_tracker']),
              { include_blank: '-- é¸æŠã—ã¦ãã ã•ã„ --', class: 'tracker-select' } %>
          <em class="info">ãƒ†ã‚¹ãƒˆã‚¿ã‚¹ã‚¯ï¼ˆUserStoryã®å­è¦ç´ ï¼‰</em>
        </p>

        <p>
          <label for="settings_bug_tracker">Bug (ãƒ¬ãƒ™ãƒ«4)</label>
          <%= select_tag 'settings[bug_tracker]',
              options_from_collection_for_select(Tracker.sorted, :name, :name,
                                                 @settings['bug_tracker']),
              { include_blank: '-- é¸æŠã—ã¦ãã ã•ã„ --', class: 'tracker-select' } %>
          <em class="info">ãƒã‚°ç®¡ç†ï¼ˆUserStory/Featureã®å­è¦ç´ ï¼‰</em>
        </p>
      </fieldset>
    </div>
  </div>

  <fieldset class="box">
    <legend>éšå±¤æ§‹é€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</legend>
    <div class="hierarchy-preview">
      <div class="hierarchy-level level-1">
        <strong id="epic-preview"><%= @settings['epic_tracker'] || 'Epic' %></strong>
        <div class="hierarchy-level level-2">
          â””â”€ <strong id="feature-preview"><%= @settings['feature_tracker'] || 'Feature' %></strong>
          <div class="hierarchy-level level-3">
            â””â”€ <strong id="user-story-preview"><%= @settings['user_story_tracker'] || 'UserStory' %></strong>
            <div class="hierarchy-level level-4">
              â”œâ”€ <span id="task-preview"><%= @settings['task_tracker'] || 'Task' %></span><br>
              â”œâ”€ <span id="test-preview"><%= @settings['test_tracker'] || 'Test' %></span><br>
              â””â”€ <span id="bug-preview"><%= @settings['bug_tracker'] || 'Bug' %></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </fieldset>
</div>

<script>
// è¨­å®šå¤‰æ›´æ™‚ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
  const selects = document.querySelectorAll('.tracker-select');

  selects.forEach(function(select) {
    select.addEventListener('change', function() {
      const trackerType = this.name.replace('settings[', '').replace(']', '').replace('_tracker', '');
      const previewId = trackerType.replace('_', '-') + '-preview';
      const previewElement = document.getElementById(previewId);

      if (previewElement) {
        previewElement.textContent = this.value || this.name.split('[')[1].split('_')[0];
      }
    });
  });
});
</script>

<hr style="margin: 30px 0;">

<div class="box tabular settings">
  <h3>MCP APIè¨­å®š</h3>
  <p class="description">
    MCP (Model Context Protocol) çµŒç”±ã§ã®API ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚<br>
    Claude Codeç­‰ã®AIãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ç®¡ç†ã§ãã¾ã™ã€‚
  </p>

  <fieldset class="box">
    <legend>ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š</legend>
    <p>
      <label for="settings_mcp_enabled">
        <%= check_box_tag 'settings[mcp_enabled]', '1', @settings['mcp_enabled'] == '1',
            id: 'settings_mcp_enabled' %>
        MCP APIã‚’æœ‰åŠ¹ã«ã™ã‚‹
      </label>
      <em class="info">ç„¡åŠ¹ã«ã™ã‚‹ã¨ã™ã¹ã¦ã®MCPãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãŒæ‹’å¦ã•ã‚Œã¾ã™</em>
    </p>
  </fieldset>

  <fieldset class="box">
    <legend>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã®è¨­å®š</legend>
    <p class="description">
      ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã®MCPã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã¯ã€å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šç”»é¢ã§ç®¡ç†ã—ã¾ã™ã€‚<br>
      ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ ã€ŒEpic Ladderã€ã‚¿ãƒ– ã§è¨­å®šã§ãã¾ã™ã€‚
    </p>
    <p class="mcp-project-info">
      <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§MCP APIã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€<br>
      1. ã“ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã§MCP APIã‚’æœ‰åŠ¹ã«ã™ã‚‹<br>
      2. å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã§ã€Œã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§MCP APIã‚’è¨±å¯ã™ã‚‹ã€ã‚’æœ‰åŠ¹ã«ã™ã‚‹
    </p>
  </fieldset>
</div>

<style>
.hierarchy-preview {
  background: #f8f8f8;
  border: 1px solid #ddd;
  padding: 15px;
  font-family: monospace;
  margin-top: 10px;
}

.hierarchy-level {
  margin-left: 20px;
  margin-top: 5px;
}

.hierarchy-level.level-1 {
  margin-left: 0;
}

.info {
  font-style: italic;
  color: #666;
  display: block;
  font-size: 0.9em;
  margin-top: 3px;
}

.mcp-project-info {
  padding: 10px;
  background: #e3f2fd;
  border: 1px solid #90caf9;
  border-radius: 4px;
  margin-top: 10px;
}
</style>
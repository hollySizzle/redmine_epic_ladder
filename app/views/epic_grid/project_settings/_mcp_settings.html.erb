<%# view_projects_form hook: 既存プロジェクトでepic_gridモジュールが有効な場合のみ表示 %>
<% if project.persisted? && project.module_enabled?(:epic_grid) %>
<% setting = EpicGrid::ProjectSetting.for_project(project) %>

<fieldset class="box epic-grid-mcp-settings">
  <legend>Epic Grid - MCP API設定</legend>

  <%= form_tag(
        project_epic_grid_project_settings_path(project),
        method: :patch,
        class: 'tabular',
        id: 'epic-grid-mcp-form'
      ) do %>
    <p>
      <label>
        <%= check_box_tag 'epic_grid_project_setting[mcp_enabled]', '1', setting.mcp_enabled,
            onchange: 'this.form.submit()' %>
        <strong>このプロジェクトでMCP APIを許可する</strong>
      </label>
      <em class="info">
        Claude Code等のAIツールからこのプロジェクトへのアクセスを許可します
      </em>
    </p>

    <noscript>
      <p><%= submit_tag l(:button_save) %></p>
    </noscript>
  <% end %>
</fieldset>

<style>
.epic-grid-mcp-settings {
  margin-top: 20px;
  background: #f8f9fa;
}
.epic-grid-mcp-settings legend {
  font-weight: bold;
  color: #333;
}
.epic-grid-mcp-settings .info {
  display: block;
  font-style: italic;
  color: #666;
  font-size: 0.9em;
  margin-top: 3px;
}
</style>
<% end %>

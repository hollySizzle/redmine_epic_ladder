<%# app/views/epic_grid/index.html.erb %>
<% content_for :header_tags do %>
  <% js_path = File.join(Rails.public_path, 'plugin_assets', 'redmine_epic_grid', 'kanban_bundle.js') %>
  <% js_mtime = File.exist?(js_path) ? File.mtime(js_path).to_i : Time.now.to_i %>
  <script src="<%= "#{Redmine::Utils.relative_url_root}/plugin_assets/redmine_epic_grid/kanban_bundle.js?v=#{js_mtime}" %>" defer></script>
  <%# MSW Service Worker registration %>
  <script>
    // MSW Service Worker のパスを設定（ルートディレクトリから配信）
    window.MSW_SERVICE_WORKER_URL = '/mockServiceWorker.js';
  </script>
<% end %>

<div class="contextual">
  <%# <%= link_to '設定', '#', class: 'icon icon-settings', title: 'カンバン設定' %>
</div>

<h2>Release Kanban - <%= @project.name %></h2>

<div id="kanban-root"
     data-project-id="<%= @project.id %>"
     data-current-user='<%= @current_user_data.to_json.html_safe %>'
     data-api-base-url="/kanban/projects/<%= @project.id %>">
  <!-- React Kanban アプリがここにマウントされます -->
  <div class="loading-spinner">
    <p>カンバンを読み込み中...</p>
  </div>
</div>
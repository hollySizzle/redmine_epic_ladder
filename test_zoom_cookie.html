<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ズームレベルCookie保存テスト</title>
</head>
<body>
    <h1>ズームレベルCookie保存テスト</h1>
    
    <div>
        <h2>現在の設定</h2>
        <p>ズームレベル: <span id="current-zoom">loading...</span></p>
        <p>Cookieから取得: <span id="cookie-zoom">loading...</span></p>
    </div>
    
    <div>
        <h2>ズームレベルを変更</h2>
        <select id="zoom-select">
            <option value="day">日</option>
            <option value="week">週</option>
            <option value="month">月</option>
            <option value="quarter">四半期</option>
            <option value="year">年</option>
        </select>
        <button onclick="changeZoom()">変更</button>
    </div>
    
    <div>
        <h2>Cookie確認</h2>
        <button onclick="showCookies()">全Cookie表示</button>
        <button onclick="clearCookies()">ガント設定Cookie削除</button>
        <pre id="cookie-display"></pre>
    </div>

    <script type="module">
        // CookieユーティリティとViewRangeManagerをインポート
        import { GanttSettings } from './assets/javascripts/react_gantt_chart/utils/cookieUtils.js';
        import { viewRangeManager } from './assets/javascripts/react_gantt_chart/utils/ViewRangeManager.js';
        
        // グローバルスコープに関数を追加
        window.GanttSettings = GanttSettings;
        window.viewRangeManager = viewRangeManager;
        
        // 初期表示
        updateDisplay();
        
        function updateDisplay() {
            document.getElementById('current-zoom').textContent = viewRangeManager.getCurrentZoom() || 'month';
            document.getElementById('cookie-zoom').textContent = GanttSettings.getZoomLevel();
            document.getElementById('zoom-select').value = viewRangeManager.getCurrentZoom() || 'month';
        }
        
        window.changeZoom = function() {
            const newZoom = document.getElementById('zoom-select').value;
            console.log('ズーム変更:', newZoom);
            
            // ViewRangeManagerでズームレベル設定（Cookie保存含む）
            viewRangeManager.setZoom(newZoom);
            
            // 表示更新
            updateDisplay();
            alert(`ズームレベルを「${newZoom}」に変更しました。ページを再読み込みして保存されているか確認してください。`);
        };
        
        window.showCookies = function() {
            const cookies = document.cookie;
            const ganttSettings = GanttSettings.get();
            
            document.getElementById('cookie-display').textContent = 
                `全Cookie: ${cookies}\n\nガント設定: ${JSON.stringify(ganttSettings, null, 2)}`;
        };
        
        window.clearCookies = function() {
            GanttSettings.reset();
            updateDisplay();
            alert('ガント設定Cookieをクリアしました');
        };
        
        // ViewRangeManagerのズーム変更リスナーを追加
        viewRangeManager.addZoomListener((newZoom) => {
            console.log('ズーム変更リスナー:', newZoom);
            updateDisplay();
        });
    </script>
</body>
</html>